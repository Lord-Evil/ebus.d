<h1>Just Chat</h1>
<div style="width: 500px;height: 500px;background-color: #ccc;" id="msgBox"></div>
<form method="POST" onsubmit="sendMessage();return false;">
	<input type="text" id="msgTxt" style="width: 500px;height: 30px;">
</form>
<script type="text/javascript">
	var conn;
	function sendMessage(){
		var msg=msgTxt.value;
		msgTxt.value="";
		conn.send(msg);
		var m = document.createElement("div");
		m.style["color"]="green";
		m.style["margin"]="5px";
		m.style["font-size"]="24px";
		m.innerHTML=msg;
		msgBox.appendChild(m);
	}
	function runWS(){
		var conn = new WebSocket("ws://"+window.location.host+"/ws");
		conn.onopen=function(e){console.log("Connection established!");};
		conn.onmessage=function(e){inMessage(e.data);};
		conn.onclose=function(e){
			console.log("Connection closed!");
			//alist.innerHTML="<b style='color:red'>Server is offline</b>";
			setTimeout(function(){conn = runWS();},1000);
		};
		function inMessage(data){
			data=JSON.parse(data);
			var m = document.createElement("div");
			m.style["color"]="red";
			m.style["margin"]="5px";
			m.style["font-size"]="24px";
			m.innerHTML=data.msg;
			//console.log(data.msg);
			msgBox.appendChild(m);
		}
		return conn;
	}
	conn = runWS();
</script>
<script type="text/javascript" src="ebus.js"></script>
<script type="text/javascript">
	//test methods
	var wURL="ws://"+window.location.host+"/ws";
	var con=EBus.connect(wURL,()=>{
		var sg=con.joinGroup("sex");
		function lol(data){console.log("Invoked")};
		sg.subscribe("huj",lol);
		sg.invoke("huj");
	});
	//
</script>